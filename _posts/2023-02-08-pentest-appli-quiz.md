---
layout: post
title:  "Exploiter une faille de sÃ©curitÃ© pour gagner un quiz de code"
date:   2023-02-08 17:24:29 +0100
image:  '/images/blog/pentest-appli-quiz/header.png'
tags:   [CybersÃ©curitÃ©]
---

Je suis Ã  Stockholm cette semaine pour la confÃ©rence <a href="https://twitter.com/JFokus" target="_blank">@JFokus</a>, et j'ai dÃ©cidÃ© de participer au quiz de l'un des sponsors. Je crois que j'ai gagnÃ© ğŸ˜‡

Voici un petit writeup de cybersÃ©curitÃ© dans lequel je vous explique comment j'ai fait.

<div class="gallery-box">
  <div class="gallery">
  <img style="height:350px; object-fit:cover" src="/images/blog/pentest-appli-quiz/1623357107792670721-FodRh1SXoAAGb32.jpg" draggable="false">
  </div>
</div>

En voyant que le classement est basÃ© sur la rapiditÃ©, j'ai eu envie de **l'automatiser** pour avoir un temps surhumain.

Mais Ã§a, c'Ã©tait avant de dÃ©couvrir trois failles dans l'appli ! (restez jusqu'au bout du thread, j'ai une technique de hacking ultra puissante Ã  vous montrer)

Avant toute chose, on doit commencer par une phase de reconnaissance : comprendre le fonctionnement du site, sa surface d'attaque, les technos utilisÃ©es cÃ´tÃ© serveur, etc.

Ici trÃ¨s simple, je regarde simplement les requÃªtes envoyÃ©es par mon ordi en faisant le quiz normalement. 

<div class="gallery-box">
  <div class="gallery">
  <img style="height:350px; object-fit:cover" src="/images/blog/pentest-appli-quiz/1623357114251976705-FodMDGAXoAEKHVf.jpg" draggable="false">
  </div>
</div>

Pour Ã§a j'utilise la console Chrome, et sur des attaques plus complexes on peut utiliser l'intercepteur de paquets **Burp Suite**.

Mon navigateur communique avec le serveur via trois URL diffÃ©rentes (/user, /questions, /highscore) aussi appelÃ©es endpoints. 

<div class="gallery-box">
  <div class="gallery">
  <img style="height:350px; object-fit:cover" src="/images/blog/pentest-appli-quiz/1623357118064517120-FodMNZZWAAAnYIc.png" draggable="false">
  </div>
</div>

L'endpoint /user sert Ã  crÃ©er un nouveau compte, et /highscore nous renvoie le classement des meilleurs joueurs.

Mais celui qui va nous intÃ©resser, c'est /questions.

La liste des questions est tirÃ©e alÃ©atoirement parmi un pool d'une vingtaine de QCM, l'endpoint /questions nous renvoie un objet JSON avec la liste des 10 questions Ã  chaque nouvelle partie. 

<div class="gallery-box">
  <div class="gallery">
  <img style="height:350px; object-fit:cover" src="/images/blog/pentest-appli-quiz/1623357125178060800-FodMZW8XEAEBPa7.jpg" draggable="false">
  </div>
</div>

Quand le quiz est terminÃ©, la page renvoie automatiquement ce mÃªme JSON au serveur, en y ajoutant un champ contenant la rÃ©ponse que j'ai donnÃ©e pour chaque question : 

<div class="gallery-box">
  <div class="gallery">
  <img style="height:350px; object-fit:cover" src="/images/blog/pentest-appli-quiz/1623357130039300106-FodMjjpXsAEK9VZ.jpg" draggable="false">
  </div>
</div>

Pour tricher, on va donc devoir Ã©crire une fonction en Python qui calcule trÃ¨s rapidement les bonnes rÃ©ponses et les renvoie au serveur pour battre le meilleur score : 

<div class="gallery-box">
  <div class="gallery">
  <img style="height:350px; object-fit:cover" src="/images/blog/pentest-appli-quiz/1623357134468485122-FodMqVwXEAAs_cU.jpg" draggable="false">
  </div>
</div>

Avec cette technique, on obtient effectivement 10/10 en moins d'une seconde, ce qui est largement suffisant pour se placer en haut du scoreboard.

Mais je vous ai promis un 11/10, alors on va creuser un peu plus.

Comment peut-on attaquer l'algorithme de validation pour dÃ©passer le score maximum ?

Comme on n'a pas le code source du serveur, on est face Ã  une boÃ®te noire et il faut essayer de deviner les potentielles erreurs commises au moment du dÃ©veloppement de l'app.

Si vous m'avez dÃ©jÃ  vu coder en stream, vous savez que les bugs Ã§a me connaÃ®t ğŸ˜

Mon premier test est de renvoyer une **liste incomplÃ¨te** de rÃ©ponses, pour voir si la vÃ©rification accepte des requÃªtes invalides. 

<div class="gallery-box">
  <div class="gallery">
  <img style="height:350px; object-fit:cover" src="/images/blog/pentest-appli-quiz/1623357144488636418-FodNRL0WYAA3bHT.jpg" draggable="false">
  </div>
</div>

Et Ã§a marche ! **En renvoyant seulement 3 rÃ©ponses, j'ai un score de 3/10**.

J'ai rarement Ã©tÃ© aussi content de ne pas avoir la moyenne, parce qu'Ã  ce moment-lÃ  je sais qu'on va pouvoir s'amuser ğŸ˜ˆ

Maintenant, on a deux options principales Ã  explorer :

- Soumettre des rÃ©ponses Ã  des questions qui ne sont pas posÃ©es
- Soumettre plusieurs fois la mÃªme rÃ©ponse

Et **les deux techniques fonctionnent** !

Pour valider un score de 11/10, on va donc utiliser ces deux bugs de validation.

Mon code envoie au serveur 11 fois la bonne rÃ©ponse sur l'une des questions du pool, et le serveur pense que j'ai rÃ©pondu 100% correct Ã  un quiz contenant 11 fois la mÃªme question ! 

<div class="gallery-box">
  <div class="gallery">
  <img style="height:350px; object-fit:cover" src="/images/blog/pentest-appli-quiz/1623357154404052992-FodNlaNWcAUV2Gf.jpg" draggable="false">
  </div>
</div>

En voyant que c'Ã©tait aussi facile de tricher (faut pas leur en vouloir, on est pas non plus sur un projet qui garde les codes de la bombe nuclÃ©aire), j'ai voulu aller un cran plus loin en contournant la validation des pseudos parce que je tenais Ã  mettre un @ au dÃ©but du mien. 

<div class="gallery-box">
  <div class="gallery">
  <img style="height:350px; object-fit:cover" src="/images/blog/pentest-appli-quiz/1623357158673850370-FodN0vbWcAEsMhc.png" draggable="false">
  </div>
</div>

Normalement on ne fait jamais confiance aux donnÃ©es qui proviennent du cÃ´tÃ© client, mais c'est super courant que les devs oublient la vÃ©rification cÃ´tÃ© serveur.

Du coup, je crafte manuellement la requÃªte qui enregistre n'importe quel nom d'utilisateur, et Ã§a passe ğŸ˜‡ 

<div class="gallery-box">
  <div class="gallery">
  <img style="height:350px; object-fit:cover" src="/images/blog/pentest-appli-quiz/1623357162494873601-FodOD9yWIAI0OID.png" draggable="false">
  </div>
</div>

VoilÃ  donc mon mini writeup sur ce quiz qui m'aura probablement beaucoup plus occupÃ© que les autres participants !

Vous voyez qu'avec des outils trÃ¨s simples, on peut trouver des trucs de fou (et je vous assure que ce genre de failles, y'en a absolument partout). 

Avant de vous montrer la super technique promise en dÃ©but de thread, un petit rappel de rigueur : chercher des failles c'est marrant, mais c'est surtout trÃ¨s illÃ©gal si vous n'avez pas la permission en amont. Sortez couverts !

Vous l'avez sÃ»rement remarquÃ©, je me sers du langage Python absolument partout, et notamment en compÃ©titions de cybersÃ©curitÃ© (Capture The Flag) parce que c'est un langage ultra polyvalent. Laissez-moi vous montrer comment automatiser des requÃªtes web super facilement. 

<div class="gallery-box">
  <div class="gallery">
  <img style="height:350px; object-fit:cover" src="/images/blog/pentest-appli-quiz/1623357172435365890-FodQGvuXwAAAeLD.jpg" draggable="false">
  </div>
</div>

Les requÃªtes HTTP/HTTPS en Python se font via le module **requests**, qui est trÃ¨s simple d'utilisation comme vous avez pu le voir sur les captures d'Ã©cran de ce thread.

Mais je trouve toujours Ã§a laborieux de simuler un vrai navigateur.

Pour automatiser les actions d'un utilisateur, on doit transmettre au serveur plusieurs infos, notamment via des headers et des cookies de connexion, ce qui est assez fatigant Ã  mettre en place avec du code Python.

Il existe une super technique pour importer dans plein de langages une requÃªte faite par votre navigateur, pour ensuite l'automatiser.

Tout d'abord, dans l'onglet RÃ©seau de la console Chrome/Firefox, clic droit sur la requÃªte qui vous intÃ©resse puis "Copy &gt; Copy as cURL (bash)" 

<div class="gallery-box">
  <div class="gallery">
  <img style="height:350px; object-fit:cover" src="/images/blog/pentest-appli-quiz/1623357183252471813-FodQY3OWIAMiAEm.png" draggable="false">
  </div>
</div>

Cette action va mettre dans votre presse-papiers une commande Bash qui reproduit cette requÃªte de maniÃ¨re absolument identique.

Mais comme on n'est pas des sauvages du Bash ici, on a une deuxiÃ¨me Ã©tape pour passer Ã§a dans Python. 

<div class="gallery-box">
  <div class="gallery">
  <img style="height:350px; object-fit:cover" src="/images/blog/pentest-appli-quiz/1623357186972827648-FodQloRX0AIaZ7i.jpg" draggable="false">
  </div>
</div>

Certes, Ã§a irait sÃ»rement beaucoup plus vite de faire un os.system pour appeler du Bash directement, mais on a un outil qui propose une maniÃ¨re beaucoup plus Ã©lÃ©gante : sur [http://curlconverter.com](http://curlconverter.com) vous pouvez transformer la commande cURL vers plein de langages en un clin d'oeil ! 

<div class="gallery-box">
  <div class="gallery">
  <img style="height:350px; object-fit:cover" src="/images/blog/pentest-appli-quiz/1623357191766917129-FodQsaXWIAA5nxq.png" draggable="false">
  </div>
</div>

C'est une astuce que j'utilise quasi quotidiennement, trÃ¨s souvent pour automatiser des actions simples, mais aussi parfois pour trouver et exploiter des vulnÃ©rabilitÃ©s sur un serveur web ğŸ˜‡

Merci d'avoir suivi cet article improvisÃ©, et surtout retenez bien : on ne fait jamais confiance Ã  l'utilisateur ğŸ˜
